\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{listings}

\lstset
{
	basicstyle=\small\ttfamily,
	columns=flexible,
	breaklines=true
}

\title{COMP1204 - Coursework 1: Unix}
\author{Daniel Best (Student ID: 29777127)}

\begin{document}
	
	\maketitle
	
	\newpage
	\section{Scripts}
	
	\subsection{Basic File Processing (countreviews.sh)}
	The first task of this coursework was to perform some basic file processing on the TripAdvisor data. Specifically, this involved retrieving the number of reviews for each hotel file, and then outputting a sorted list of hotels, ordered by the most reviews to least. \newline
	
	\noindent
	The script file designed for this task, \textbf{countreviews.sh}, can be seen below:
	
	\begin{lstlisting}
	#!/bin/bash
	
	for file in $1/*; do	
		echo "$(basename $file .dat) $(grep -c "<Author>" $file)"
	done | sort -n -r -k 2
	\end{lstlisting}

	\noindent
	This script loops through each \textbf{file} in given file path, which is represented as \textbf{\$1/*} in the code. For each file, the script outputs the \textbf{basename}, i.e. the name of the file without the file path or extension, and the number of \textbf{{\textless}Author\textgreater} tags in the file, which represents the amount of reviews. This second value is found by using the \textbf{grep} command, with the \textbf{-c} argument specifying that the number of instances of the search query found should be returned, as opposed to the usual output of the found instances themselves. \newline
	
	\noindent
	Once the for loop has been completed, the output is piped into the \textbf{sort} command, which sorts the results in numerical order (\textbf{-n}), in reverse order (\textbf{-r}), and based on the second column (\textbf{-k 2}).
	
	\newpage
	\subsection{Data Analysis (averagereviews.sh)}
	The other scripting task for this coursework was to perform data analysis on the same TripAdvisor dataset. In particular, the task was to get the average overall rating for each hotel by calculating the mean of all the \textbf{{\textless}Overall\textgreater} values found in the file. \newline
	
	\noindent
	The \textbf{averagereviews.sh} script file was created to perform this task, and can be seen below:
	
	\begin{lstlisting}
	#!/bin/bash

	for file in $1/*; do
		total=0
		i=0
		for rating in $(grep "<Overall>" $file | sed 's/^.*<Overall>//; s/\r$//'); do
			total=$((total + rating))
			i=$((i + 1));
		done
		name=$(basename $file .dat)
		echo | awk -v name="$name" -v total="$total" -v i="$i" '{printf "%s %.2f\n", name, total/i}';
	done | sort -n -r -k 2
	\end{lstlisting}
	
	\section{Discussion}
	
\end{document}